<!DOCTYPE html>
<html>
<head>
    <title>Food Search Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
        input { padding: 8px; margin: 5px; }
        button { padding: 8px 15px; margin: 5px; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Food Search Debug Test</h1>
    
    <div>
        <input type="text" id="searchInput" placeholder="Enter food name (e.g., milk)" value="milk">
        <button onclick="testSearch()">Test Search</button>
        <button onclick="clearResults()">Clear</button>
    </div>
    
    <div id="results"></div>
    
    <script>
    async function testSearch() {
        const query = document.getElementById('searchInput').value.trim();
        const resultsDiv = document.getElementById('results');
        
        if (!query) {
            resultsDiv.innerHTML = '<div class="error">Please enter a search term</div>';
            return;
        }
        
        resultsDiv.innerHTML = '<div>Searching...</div>';
        
        try {
            console.log('Making API call to:', `/api/foods/search-verified?q=${encodeURIComponent(query)}`);
            
            const response = await fetch(`/api/foods/search-verified?q=${encodeURIComponent(query)}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'same-origin'
            });
            
            console.log('Response status:', response.status);
            console.log('Response ok:', response.ok);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Error response:', errorText);
                resultsDiv.innerHTML = `<div class="error">Error ${response.status}: ${errorText}</div>`;
                return;
            }
            
            const data = await response.json();
            console.log('Response data:', data);
            console.log('Data type:', typeof data);
            console.log('Is array:', Array.isArray(data));
            console.log('Length:', data.length);
            
            if (!data || data.length === 0) {
                resultsDiv.innerHTML = '<div class="error">No foods found</div>';
                return;
            }
            
            let html = `<div class="success">Found ${data.length} foods:</div>`;
            
            data.forEach((food, index) => {
                html += `
                    <div class="result">
                        <strong>${index + 1}. ${food.name}</strong>
                        <br>Category: ${food.category}
                        <br>Calories: ${food.calories_per_100g} per 100g
                        <br>Protein: ${food.protein_per_100g}g per 100g
                        <br>Verified: ${food.verified}
                        <br>Default serving: ${food.default_serving_size_grams}g
                        <br><small>ID: ${food.id}</small>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            
        } catch (error) {
            console.error('Fetch error:', error);
            resultsDiv.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
        }
    }
    
    function clearResults() {
        document.getElementById('results').innerHTML = '';
    }
    
    // Auto-test on page load
    window.onload = function() {
        console.log('Page loaded, testing search...');
        testSearch();
    };
    </script>
</body>
</html>
